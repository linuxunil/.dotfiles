---
- name: Create configuration directories
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/{{ item }}"
    state: directory
    mode: '0755'
  loop: "{{ config_directories }}"

- name: Create dotfile symlinks for all hosts
  ansible.builtin.file:
    src: "{{ playbook_dir }}/dotfiles/{{ item.src }}"
    dest: "{{ ansible_env.HOME }}/{{ item.dest }}"
    state: link
    force: yes
  loop: "{{ dotfiles_links }}"

- name: Create custom dotfile symlinks
  ansible.builtin.file:
    src: "{{ playbook_dir }}/dotfiles/{{ item.src }}"
    dest: "{{ ansible_env.HOME }}/{{ item.dest }}"
    state: link
    force: yes
  loop: "{{ custom_dotfiles | default([]) }}"
  when: custom_dotfiles is defined

- name: Make shell scripts executable
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/{{ item.dest }}"
    mode: '0755'
  loop: "{{ dotfiles_links }}"
  when: 
    - item.dest.startswith('.local/bin/')
    - item.dest | basename in ['dev-session', 'editor-test', 'ide-launcher']